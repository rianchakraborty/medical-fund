<!--
Ketto Alternative Donation Page
Stack: Static HTML + Razorpay Checkout + optional Stripe Payment Link fallback
Backend: Minimal serverless (Node) to create Razorpay Orders securely
Deploy: Vercel/Netlify/Cloudflare Pages + Functions
-->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Support Rian's Uncle – Medical Fund</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --bg:#0b1020; --card:#121937; --muted:#9fb0ff; --text:#e8edff; --accent:#6ea8ff; }
    *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:radial-gradient(120vh 120vh at 80% -10%, #1e2a66 0%, #0b1020 50%), var(--bg);color:var(--text)}
    .wrap{max-width:960px;margin:0 auto;padding:24px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));backdrop-filter:blur(4px);border:1px solid rgba(255,255,255,.08);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.4)}
    header{display:flex;gap:16px;align-items:center;margin:32px 0}
    header img{width:56px;height:56px;border-radius:12px;border:1px solid rgba(255,255,255,.2)}
    h1{font-size:28px;margin:0 0 4px}
    .muted{color:var(--muted);font-size:14px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    @media (max-width:800px){.grid{grid-template-columns:1fr}}
    .pad{padding:20px}
    .badge{display:inline-block;padding:4px 10px;border-radius:999px;background:#0b143b;color:#bcd0ff;border:1px solid rgba(255,255,255,.1);font-size:12px}
    .amounts{display:flex;flex-wrap:wrap;gap:8px;margin:8px 0}
    .chip{border:1px solid rgba(255,255,255,.15);background:#0d1440;color:#cfe0ff;padding:10px 14px;border-radius:12px;cursor:pointer}
    .chip.active{border-color:var(--accent);box-shadow:0 0 0 2px rgba(110,168,255,.25) inset}
    .field{display:flex;flex-direction:column;gap:6px;margin:10px 0}
    .field input,.field textarea{background:#0a1133;color:#eaf0ff;border:1px solid rgba(255,255,255,.12);padding:12px 14px;border-radius:10px;font-size:14px}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:12px 16px;border-radius:12px;border:1px solid rgba(255,255,255,.15);background:linear-gradient(180deg,#3469ff,#2856d8);color:white;font-weight:700;cursor:pointer}
    .btn.secondary{background:#0c1440}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .notice{font-size:12px;color:#bcd0ff}
    .success,.error{padding:10px 12px;border-radius:10px;margin-top:12px}
    .success{background:#0e2f1a;color:#d1ffe2;border:1px solid #2a6840}
    .error{background:#2f0e11;color:#ffd1d6;border:1px solid #68313b}
    footer{margin:28px 0;color:#a9b8ff;font-size:12px}
    .qr{width:140px;height:140px;border-radius:12px;border:1px solid rgba(255,255,255,.15)}
  </style>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="card pad">
      <header>
        <img src="https://images.unsplash.com/photo-1504814532849-cffc7a1ee0dc?q=80&w=300&auto=format&fit=crop" alt="Care"/>
        <div>
          <h1>Support Treatment – Lung Cancer (Stage IV)</h1>
          <div class="muted">All proceeds go directly to the patient’s family. UPI, Cards, Netbanking, Wallets supported. International cards accepted.</div>
        </div>
      </header>
      <div class="grid">
        <section class="pad" style="padding-top:0">
          <span class="badge">Quick Donate</span>
          <div class="amounts" id="preset">
            <button class="chip" data-amt="500">₹500</button>
            <button class="chip" data-amt="1000">₹1,000</button>
            <button class="chip" data-amt="2500">₹2,500</button>
            <button class="chip" data-amt="5000">₹5,000</button>
            <button class="chip" data-amt="10000">₹10,000</button>
          </div>
          <div class="field">
            <label>Custom Amount (INR)</label>
            <input id="amount" type="number" min="1" step="1" placeholder="e.g. 1500" />
          </div>
          <div class="field">
            <label>Your Name (for receipt)</label>
            <input id="name" type="text" placeholder="Optional" />
          </div>
          <div class="field">
            <label>Email (to receive confirmation)</label>
            <input id="email" type="email" placeholder="Optional" />
          </div>
          <div class="row">
            <button class="btn" id="donateBtn">Donate Securely</button>
            <button class="btn secondary" id="stripeBtn" title="International fallback">Donate via Stripe</button>
          </div>
          <div id="msg"></div>
          <p class="notice">Fees: Razorpay ~2%–3% + taxes (vs ~20% on some crowdfunding sites). UPI has lowest fees. International cards supported (FX may apply).</p>
        </section>
        <aside class="pad" style="padding-top:0">
          <span class="badge">No‑fee UPI (India)</span>
          <div class="row" style="align-items:center;gap:16px;margin-top:8px">
            <img class="qr" id="upiQR" alt="UPI QR" src=""/>
            <div>
              <div class="muted">Scan to pay via UPI apps (GPay/PhonePe/Paytm)</div>
              <div style="margin:8px 0;font-weight:600" id="upiIdText">UPI: <code>example@okicici</code></div>
              <a class="btn secondary" id="upiIntent" href="#">Open UPI App</a>
            </div>
          </div>
          <hr style="border:none;border-top:1px solid rgba(255,255,255,.12);margin:20px 0"/>
          <div class="muted">Transparency</div>
          <ul>
            <li>Funds settle to family’s bank account.</li>
            <li>We will share periodic expense summaries.</li>
            <li>Contact: <a href="mailto:help@example.org">help@example.org</a></li>
          </ul>
        </aside>
      </div>
      <footer>
        Built with ❤️. Payments by Razorpay. International fallback via Stripe Payment Link.
      </footer>
    </div>
  </div>

<script>
  // ---- CONFIG: Set these before deploying ----
  const CONFIG = {
    RAZORPAY_KEY_ID: "rzp_test_xxxxx", // from Razorpay Dashboard
    BACKEND_CREATE_ORDER_URL: "/api/create-order", // your serverless endpoint
    UPI: {
      id: "example@okicici", // your real UPI ID
      payee: "Medical Fund",
      note: "Treatment Support",
      min: 1
    },
    STRIPE_PAYMENT_LINK: "https://buy.stripe.com/test_XXXXXXXX", // optional fallback link you create in Stripe
  };

  // --- UPI QR/Intent
  function setUPI(amount){
    const a = Math.max(CONFIG.UPI.min, Number(amount||0) || 0);
    const uri = `upi://pay?pa=${encodeURIComponent(CONFIG.UPI.id)}&pn=${encodeURIComponent(CONFIG.UPI.payee)}&am=${a>0?a:``}&cu=INR&tn=${encodeURIComponent(CONFIG.UPI.note)}`;
    const qrApi = `https://api.qrserver.com/v1/create-qr-code/?size=140x140&data=${encodeURIComponent(uri)}`;
    document.getElementById('upiQR').src = qrApi;
    document.getElementById('upiIntent').href = uri;
    document.getElementById('upiIdText').innerHTML = `UPI: <code>${CONFIG.UPI.id}</code>`;
  }

  setUPI(0);

  // --- Amount chips
  const chips = Array.from(document.querySelectorAll('.chip'));
  const amountInput = document.getElementById('amount');
  chips.forEach(ch => ch.addEventListener('click', () => {
    chips.forEach(c => c.classList.remove('active'));
    ch.classList.add('active');
    amountInput.value = ch.dataset.amt;
    setUPI(amountInput.value);
  }));
  amountInput.addEventListener('input', () => setUPI(amountInput.value));

  // --- Razorpay Checkout Flow
  const donateBtn = document.getElementById('donateBtn');
  const stripeBtn = document.getElementById('stripeBtn');
  const msg = document.getElementById('msg');
  function alertMsg(kind,text){
    msg.innerHTML = `<div class="${kind}">${text}</div>`;
  }

  donateBtn.addEventListener('click', async () => {
    const amountInr = Math.max(1, parseInt(amountInput.value || '0', 10));
    if (!amountInr) { alertMsg('error','Please enter a valid amount.'); return; }

    try{
      alertMsg('success','Creating order…');
      const res = await fetch(CONFIG.BACKEND_CREATE_ORDER_URL, {
        method: 'POST', headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ amount_inr: amountInr, name: document.getElementById('name').value, email: document.getElementById('email').value })
      });
      if(!res.ok) throw new Error('Order API failed');
      const { order, keyId } = await res.json();

      const options = {
        key: keyId || CONFIG.RAZORPAY_KEY_ID,
        amount: order.amount,
        currency: order.currency,
        name: 'Medical Fund',
        description: 'Treatment Support',
        order_id: order.id,
        prefill: { name: document.getElementById('name').value, email: document.getElementById('email').value },
        theme: { color: '#3469ff' },
        handler: function (response){
          alertMsg('success', 'Payment initiated. Verifying…');
          // Optionally POST response to backend to verify signature & record donation
          fetch('/api/verify', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(response) });
        }
      };
      const rzp = new Razorpay(options);
      rzp.on('payment.failed', function (resp){
        alertMsg('error', 'Payment failed. You were not charged.');
      });
      rzp.open();
    } catch(e){
      console.error(e);
      alertMsg('error','Could not create order. Please try again or use UPI/Stripe fallback.');
    }
  });

  stripeBtn.addEventListener('click', () => {
    if (CONFIG.STRIPE_PAYMENT_LINK && CONFIG.STRIPE_PAYMENT_LINK.startsWith('http')) {
      window.location.href = CONFIG.STRIPE_PAYMENT_LINK;
    } else {
      alertMsg('error','Stripe Payment Link not configured.');
    }
  });
</script>
</body>
</html>

<!-- ========================= BACKEND (Serverless) =========================
Save as: /api/create-order.js (Vercel/Netlify/Cloudflare Workers variant below)
Purpose: Create Razorpay order securely. Do NOT expose secret key in frontend.
---------------------------------------------------------------------------- -->

// Vercel/Netlify (Node): /api/create-order.js
// Env vars required:
//  RAZORPAY_KEY_ID=rzp_live_xxx
//  RAZORPAY_KEY_SECRET=live_secret_xxx

/*
const Razorpay = require('razorpay');

export default async function handler(req, res){
  if (req.method !== 'POST') return res.status(405).json({error:'Method not allowed'});
  const { amount_inr } = req.body || {};
  if (!amount_inr || amount_inr < 1) return res.status(400).json({error:'Invalid amount'});

  const instance = new Razorpay({ key_id: process.env.RAZORPAY_KEY_ID, key_secret: process.env.RAZORPAY_KEY_SECRET });
  try{
    const order = await instance.orders.create({ amount: amount_inr * 100, currency: 'INR', payment_capture: 1, notes: { purpose:'Medical Fund' }});
    res.status(200).json({ order, keyId: process.env.RAZORPAY_KEY_ID });
  }catch(e){
    console.error(e);
    res.status(500).json({error:'Order creation failed'});
  }
}
*/

// --- Optional: Verify payment signature & record (e.g., Google Sheets/Airtable)
/*
// /api/verify.js
import crypto from 'crypto';
export default async function handler(req,res){
  if (req.method !== 'POST') return res.status(405).json({});
  const { razorpay_order_id, razorpay_payment_id, razorpay_signature } = req.body || {};
  const body = `${razorpay_order_id}|${razorpay_payment_id}`;
  const expected = crypto.createHmac('sha256', process.env.RAZORPAY_KEY_SECRET).update(body).digest('hex');
  const ok = expected === razorpay_signature;
  // TODO: persist donation record (amount, name/email if provided) in your DB/Sheet
  res.status(200).json({ verified: ok });
}
*/

// ===================== Cloudflare Workers (Alternative) =====================
/*
import Razorpay from 'razorpay';
export default {
  async fetch(request, env) {
    if (new URL(request.url).pathname !== '/api/create-order' || request.method !== 'POST')
      return new Response('Not Found', { status: 404 });
    const { amount_inr } = await request.json();
    if (!amount_inr || amount_inr < 1) return new Response(JSON.stringify({error:'Invalid amount'}), {status:400});
    const rzp = new Razorpay({ key_id: env.RAZORPAY_KEY_ID, key_secret: env.RAZORPAY_KEY_SECRET });
    const order = await rzp.orders.create({ amount: amount_inr * 100, currency: 'INR', payment_capture: 1 });
    return new Response(JSON.stringify({ order, keyId: env.RAZORPAY_KEY_ID }), { headers:{'Content-Type':'application/json'} });
  }
}
*/

// ============================ README (Quickstart) ===========================
/*
1) Create Razorpay account (IND). Complete KYC → get KEY_ID & KEY_SECRET.
2) (Optional) Create a Stripe Payment Link for international donors; paste URL into CONFIG.STRIPE_PAYMENT_LINK.
3) Deploy frontend (this HTML) on Vercel/Netlify/Cloudflare Pages.
4) Add serverless function /api/create-order with env vars (KEY_ID/KEY_SECRET).
5) Replace CONFIG.UPI.id with your UPI ID; page auto-generates QR + intent link.
6) Test in Razorpay Test Mode first, then switch to live keys.
7) Share the site URL. Maintain transparency logs separately (Google Sheet).
Security: Never expose KEY_SECRET in frontend; always create orders server‑side.
Fees (typical): 2%–3% + GST domestically; international cards ~3%–4% + FX.
*/
Add index.html for donation page
